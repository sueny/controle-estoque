package projeto.engenharia.software.controle.estoque.test.material.stateMachine;

import projeto.engenharia.software.controle.estoque.test.material.adapter.impl.CadastroMaterialWeb;
import projeto.engenharia.software.controle.estoque.test.adapter.IAdapterMaterial;

public class MaterialContext extends java.lang.Object implements java.lang.Cloneable {

    public MaterialState state;
    public Integer skuMaterial;
    public Integer unitMaterial;
    public Boolean registerStatus;
    
    private IAdapterMaterial adapter;

    public MaterialContext() {
        state = MaterialState.Idle;
        registerStatus = false;
        skuMaterial = 0;
        unitMaterial = 0;
        adapter = new CadastroMaterialWeb();

    }

    public MaterialContext clone() {
        MaterialContext cl = new MaterialContext();

        cl.state = this.state;
        cl.skuMaterial = this.skuMaterial;
        cl.unitMaterial = this.unitMaterial;
        cl.registerStatus = this.registerStatus;
        cl.adapter = this.adapter;

        return cl;
    }

    public void handleEvent(Object... in_colObject) {
        if (in_colObject.length > 0) {

            String sEventName = (String) in_colObject[0];
            if ((state == MaterialState.Idle) && (sEventName.compareTo("registerEvent") == 0)) {
                //values generated by parteg
                //skuMaterial = ((Integer)in_colObject[1]).intValue();
                //unitMaterial = ((Integer)in_colObject[1]).intValue();

                state = MaterialState.Registering;

            } else if ((state == MaterialState.Registering) && (sEventName.compareTo("validEvent") == 0)) {
                skuMaterial = ((Integer) in_colObject[1]).intValue();
                unitMaterial = ((Integer) in_colObject[2]).intValue();

                registerStatus = registerIsValid(skuMaterial, unitMaterial);

                if (registerStatus == false) {
                    state = MaterialState.Registering;
                } else {
                    saveData(skuMaterial, unitMaterial);
                    state = MaterialState.Registered;
                }

            } else if ((state == MaterialState.Registered) && (sEventName.compareTo("newRegisterEvent") == 0)) {

                state = MaterialState.Registering;

            } else if ((state == MaterialState.Registered) && (sEventName.compareTo("finaliseEvent") == 0)) {
                closeSection();

            }

        }
    }

    protected Boolean registerIsValid(Integer sku, Integer unit) {
        if (sku >= 1 && unit >= 1) {
            return true;
        } else {
            return false;
        }
    }

    protected void closeSection() {
        adapter.closeSession();
    }

    protected void saveData(Integer sku, Integer unit) {
        adapter.appSaveData(sku, unit);
    }
}
